---

- hosts: all
  become: yes
  become_user: zyzyx
  become_method: sudo
  tasks:

  - name: update and upgrade distro
    apt: 
      update_cache: yes
      upgrade: dist
  
  - name: update and upgrade all packages
    apt:
      name: "*"
      state: latest

  - name: install base apps
    apt:
      name:
        - curl
        - tmux
        - cmatrix
        - htop
        - neofetch
        - ca-certificates
        - gnupg
        - lsb-release
        - zsh
        - zplug
        - wget
        - unzip
      state: latest

  - name: Make folders for Git projects
    file:
      path: "{{ item }}"
      state: directory
      owner: zyzyx
      group: zyzyx
      mode: '0770'
    loop:
      - /home/zyzyx/Git
      - /home/zyzyx/Git/ohmyzsh # delete after install
      - /usr/local/bin/oh-my-posh # owned by root
      - /home/zyzyx/.poshthemes # owned by me

  - name: Download oh-my-zsh installer
    get_url:
      url: https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh
      dest: /home/zyzyx/Git/ohmyzsh/install.sh

  - name: Clone zsh autocomplet repository
    git:
      repo: https://github.com/marlonrichert/zsh-autocomplete.git
      dest: /home/zyzyx/.oh-my-zsh/custom/plugins/zsh-autocomplete
      clone: yes
      update: yes

  - name: Clone zsh suggestions repository
    git:
      repo: https://github.com/zsh-users/zsh-autosuggestions
      dest: /home/zyzyx/.oh-my-zsh/custom/plugins/zsh-autosuggestions
      clone: yes
      update: yes

  - name: Download and unzip poshthemes
    unarchive: 
      src: https://github.com/JanDeDobbeleer/oh-my-posh/releases/latest/download/themes.zip
      dest: /home/zyzyx/.poshthemes
      remote_src: yes

  - name: Add execute permsions to scripts
    file:
      path: "{{ item }}"
      state: file
      mode: u+rwx,g+rwx,o-rwx
    loop:
      - /home/zyzyx/Git/ohmyzsh/install.sh

  - name: Run oh-my-zsh installer
    command: sh /home/zyzyx/Git/ohmyzsh/install.sh --unattended